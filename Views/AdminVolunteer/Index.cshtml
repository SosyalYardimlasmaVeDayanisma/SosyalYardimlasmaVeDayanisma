@model List<AfetPuan.Models.VolunteerApplication>
@using AfetPuan.Models
@{
    ViewData["Title"] = "G√∂n√ºll√ºl√ºk Ba≈üvurularƒ±";
    
    var pendingCount = Model.Count(a => a.Status == ApplicationStatus.Pending);
    var approvedCount = Model.Count(a => a.Status == ApplicationStatus.Approved);
    var rejectedCount = Model.Count(a => a.Status == ApplicationStatus.Rejected);
}

<div class="container page-container">
    <div style="margin-bottom: 32px;">
        <h1 class="page-title">G√∂n√ºll√ºl√ºk Ba≈üvurularƒ± üë•</h1>
        <p class="page-description">
            G√∂n√ºll√º olmak isteyen ki≈üilerin ba≈üvurularƒ±nƒ± inceleyin ve y√∂netin.
        </p>
    </div>

    <!-- ƒ∞statistikler -->
    <div class="stats-grid" style="margin-bottom: 32px;">
        <div class="card stat-card">
            <div class="stat-value" style="color: #F59E0B;">@pendingCount</div>
            <div class="stat-label">Bekleyen</div>
        </div>
        <div class="card stat-card">
            <div class="stat-value" style="color: #10B981;">@approvedCount</div>
            <div class="stat-label">Onaylanan</div>
        </div>
        <div class="card stat-card">
            <div class="stat-value" style="color: #EF4444;">@rejectedCount</div>
            <div class="stat-label">Reddedilen</div>
        </div>
    </div>

    @if (!Model.Any())
    {
        <div class="card" style="text-align: center; padding: 60px 20px;">
            <div style="font-size: 48px; margin-bottom: 16px;">üì≠</div>
            <h3 style="font-size: 20px; font-weight: 700; color: var(--text-primary); margin-bottom: 8px;">
                Hen√ºz ba≈üvuru yok
            </h3>
            <p style="color: var(--text-secondary);">
                G√∂n√ºll√º ba≈üvurularƒ± buradan g√∂r√ºnt√ºlenecek.
            </p>
        </div>
    }
    else
    {
        <div class="card">
            <div class="table-responsive">
                <table class="table">
                    <thead>
                        <tr>
                            <th>Tarih</th>
                            <th>Ad Soyad</th>
                            <th>E-posta</th>
                            <th>ƒ∞l</th>
                            <th>G√∂n√ºll√ºl√ºk Alanƒ±</th>
                            <th>Durum</th>
                            <th>ƒ∞≈ülemler</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var app in Model)
                        {
                            var statusColor = app.Status switch
                            {
                                ApplicationStatus.Pending => "#F59E0B",
                                ApplicationStatus.Approved => "#10B981",
                                ApplicationStatus.Rejected => "#EF4444",
                                _ => "#6B7280"
                            };

                            var statusText = app.Status switch
                            {
                                ApplicationStatus.Pending => "Beklemede",
                                ApplicationStatus.Approved => "Onaylandƒ±",
                                ApplicationStatus.Rejected => "Reddedildi",
                                _ => "Bilinmiyor"
                            };

                            <tr data-application-id="@app.Id">
                                <td>@app.CreatedAt.ToString("dd.MM.yyyy HH:mm")</td>
                                <td>
                                    <strong>@app.FullName</strong>
                                    @if (!string.IsNullOrEmpty(app.Notes))
                                    {
                                        <div style="font-size: 12px; color: var(--text-secondary); margin-top: 4px;">
                                            @app.Notes
                                        </div>
                                    }
                                </td>
                                <td>@app.Email</td>
                                <td>@app.City</td>
                                <td>@app.VolunteerArea</td>
                                <td>
                                    <span class="status-badge" style="background: @statusColor; color: white;">
                                        @statusText
                                    </span>
                                </td>
                                <td>
                                    <div style="display: flex; gap: 8px;">
                                        @if (app.Status == ApplicationStatus.Pending)
                                        {
                                            <button class="btn btn-sm" style="background: #10B981; color: white; padding: 6px 12px;" onclick="updateStatus(@app.Id, 1)">
                                                ‚úì Onayla
                                            </button>
                                            <button class="btn btn-sm" style="background: #EF4444; color: white; padding: 6px 12px;" onclick="updateStatus(@app.Id, 2)">
                                                ‚úó Reddet
                                            </button>
                                        }
                                        else
                                        {
                                            <button class="btn btn-sm btn-outline" onclick="updateStatus(@app.Id, 0)">
                                                ‚Üª Bekletmeye Al
                                            </button>
                                        }
                                        <button class="btn btn-sm btn-outline" style="color: #EF4444; border-color: #EF4444;" onclick="deleteApplication(@app.Id)">
                                            üóëÔ∏è
                                        </button>
                                    </div>
                                    @if (!string.IsNullOrEmpty(app.AdminNotes))
                                    {
                                        <div style="font-size: 12px; color: var(--text-secondary); margin-top: 8px; font-style: italic;">
                                            Not: @app.AdminNotes
                                        </div>
                                    }
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    }
</div>

<style>
    .table-responsive {
        overflow-x: auto;
    }

    .table {
        width: 100%;
        border-collapse: collapse;
    }

    .table thead {
        background: var(--bg-secondary);
    }

    .table th {
        padding: 16px;
        text-align: left;
        font-weight: 600;
        font-size: 14px;
        color: var(--text-secondary);
        border-bottom: 2px solid #E5E7EB;
    }

    .table td {
        padding: 16px;
        border-bottom: 1px solid #E5E7EB;
        font-size: 14px;
        color: var(--text-primary);
    }

    .table tbody tr:hover {
        background: var(--bg-secondary);
    }

    .status-badge {
        display: inline-block;
        padding: 4px 12px;
        border-radius: 12px;
        font-size: 12px;
        font-weight: 600;
    }
</style>

<script>
    async function updateStatus(applicationId, status) {
        const statusNames = ['Beklemede', 'Onaylandƒ±', 'Reddedildi'];
        const adminNotes = prompt(`Durum: ${statusNames[status]}\n\nƒ∞steƒüe baƒülƒ± not ekleyebilirsiniz:`);
        
        // Kullanƒ±cƒ± iptal ederse i≈ülemi durdur
        if (adminNotes === null) return;

        try {
            const response = await fetch('/AdminVolunteer/UpdateStatus', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: new URLSearchParams({
                    id: applicationId,
                    status: status,
                    adminNotes: adminNotes || ''
                })
            });

            const result = await response.json();
            
            if (result.success) {
                alert('‚úì Ba≈üvuru durumu g√ºncellendi');
                location.reload();
            } else {
                alert('‚úó ' + result.message);
            }
        } catch (error) {
            alert('‚úó Bir hata olu≈ütu: ' + error.message);
        }
    }

    async function deleteApplication(applicationId) {
        if (!confirm('Bu ba≈üvuruyu silmek istediƒüinizden emin misiniz?')) {
            return;
        }

        try {
            const response = await fetch('/AdminVolunteer/Delete', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: new URLSearchParams({
                    id: applicationId
                })
            });

            const result = await response.json();
            
            if (result.success) {
                alert('‚úì Ba≈üvuru silindi');
                location.reload();
            } else {
                alert('‚úó ' + result.message);
            }
        } catch (error) {
            alert('‚úó Bir hata olu≈ütu: ' + error.message);
        }
    }
</script>
